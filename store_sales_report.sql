set termout off
set pagesize 0
set feedback off
set heading off
SET TRIMSPOOL ON
set linesize 2000
spool D:\BI_Report\work\JV_BI_EAST_SALES_REPORT.&1..csv
set verify off
select '日期,区域,商品编码,商品名称,品类编码,品类名称,大类编码,大类名称,中类编码,中类名称,小类编码,小类名称,销售数量,销售金额,销售净额'
from dual ;
select YYYYMMDD||','||
BU_NAME||','||
GOODS_ID||','||
GOODS_SHORT_NAME||','||
CURRENT_CATEGORY_LV2_CODE||','||
CURRENT_CATEGORY_LV2_NAME||','||
CURRENT_CATEGORY_LV3_CODE||','||
CURRENT_CATEGORY_LV3_NAME||','||
CURRENT_CATEGORY_LV4_CODE||','||
CURRENT_CATEGORY_LV4_NAME||','||
CURRENT_CATEGORY_LV5_CODE||','||
CURRENT_CATEGORY_LV5_NAME||','||
UNITS||','||
VAT_RETAIL||','||
NET_RETAIL
 from (SELECT TO_CHAR(F.DAY_DATE,'YYYYMMDD') YYYYMMDD,C.BU_NAME,D.GOODS_ID,D.GOODS_SHORT_NAME,E.CURRENT_CATEGORY_LV2_CODE,E.CURRENT_CATEGORY_LV2_NAME,E.CURRENT_CATEGORY_LV3_CODE,E.CURRENT_CATEGORY_LV3_NAME,E.CURRENT_CATEGORY_LV4_CODE,E.CURRENT_CATEGORY_LV4_NAME,E.CURRENT_CATEGORY_LV5_CODE,E.CURRENT_CATEGORY_LV5_NAME,ROUND(SUM(NVL(CASE
WHEN A.MEASURE_WID = 193 THEN
A.METRIC
END,
0)),
2) Units,ROUND(SUM(NVL(CASE
WHEN A.MEASURE_WID = 174 THEN
A.METRIC
END,
0)),
2) Vat_retail,ROUND(SUM(NVL(CASE
WHEN A.MEASURE_WID = 175 THEN
A.METRIC
END,
0)),
2) Net_Retail
FROM CRV_JVBI_DM.TA_KPI_DATA  A,
CRV_JVBI_DM.TD_MEASURE   B,
CRV_JVBI_DM.TD_SHOP      C,
CRV_JVBI_DM.TD_GOODS     D,
CRV_JVBI_DM.TD_GOODS_LV5 E,
CRV_JVBI_DM.TD_DATE_DAY  F
WHERE A.MEASURE_WID = B.ROW_WID
AND A.MEASURE_WID IN (174,175,193)
AND A.SHOP_WID = C.ROW_WID
AND C.BU_NAME = 'JV华东'
and C.SHOP_CODE NOT IN ('204375','204376','204377','204378')
AND A.GOODS_WID = D.ROW_WID
AND D.CATEGORY_LV5_WID = E.ROW_WID
AND A.DAY_WID = F.DAY_WID
AND TO_CHAR(F.DAY_DATE,'YYYYMMDD') = TO_CHAR(SYSDATE,'YYYYMMDD') -1
AND D.GOODS_ID IN  (2387735,217746,2383236,2383251,
572525,2265547 ,2265562 ,8001796 ,8001798 
,1736415 ,889372 ,173934 ,1729102 ,2369671 ,1987112 ,2296549 ,1559499 ,1352209 
,352208 ,1352213 ,1352214 ,1352216,002057995 ,2111986 ,001774499 ,009042948 
,002044165 ,002109023 ,001862499 ,2368055 ,5681 ,1727497,1698820,2335543,2335544,1727496
,002176753 ,001870003 ,2127955 ,2391405 
,002382382) 
GROUP BY TO_CHAR(F.DAY_DATE,'YYYYMMDD'),
C.BU_NAME,
D.GOODS_ID,
D.GOODS_SHORT_NAME,
E.CURRENT_CATEGORY_LV2_CODE,
E.CURRENT_CATEGORY_LV2_NAME,
E.CURRENT_CATEGORY_LV3_CODE,
E.CURRENT_CATEGORY_LV3_NAME,
E.CURRENT_CATEGORY_LV4_CODE,
E.CURRENT_CATEGORY_LV4_NAME,
E.CURRENT_CATEGORY_LV5_CODE,
E.CURRENT_CATEGORY_LV5_NAME
order by 15 desc);

spool off;
exit;

